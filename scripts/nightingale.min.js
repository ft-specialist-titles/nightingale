function init(){function e(e,t){var n=r.get("originalData");return e.map(function(e,r){return e[t]=n[r][t],e})}var t=new Graphic,r=new DataImport,n=new ViewGraphicControls({model:t,dataImport:r});document.getElementById("controls").appendChild(n.render().el);var i=new Backbone.Collection([new GraphicType({typeName:"Line"},{graphic:t,controls:new LineControls,variations:Variations}),new GraphicType({typeName:"Column"},{graphic:t,controls:new ColumnControls,variations:Variations})]),a=new ViewGraphicTypes({collection:i});document.getElementById("charts").appendChild(a.render().el);var o;Backbone.on("selectVariation",function(e){if(o){if(o.model===e)return;o.remove()}e&&e.get("svg")&&(o=new ViewSelectedVariation({model:e}),o.render(),document.getElementById("selection").appendChild(o.el))}),r.on("change:pipelineOptions",function(e,r){if(!r)return void t.set(t.defaults);var n=_.pick(r,"title","subtitle","source","footnote");t.set(n)}),r.on("change:data",function(e,r){t.chart.dataset.set("rows",r)});var s=new ViewImportData({model:r});document.getElementById("controls").appendChild(s.render().el);var c=function(e,r){e.collection=null;var n,i=e.get("axis");"undefined"!=typeof e._previousAttributes.axis&&(n=e._previousAttributes.axis,n&&i!==n&&("Y"===n?t.chart.yAxis.columns.remove(e):"Z"===n&&t.chart.zAxis.columns.remove(e))),i&&("Y"===i?t.chart.yAxis.columns.add(e):"Z"===i&&t.chart.zAxis.columns.add(e))};if(r.columns.on("change:axis",c),r.columns.on("reset",function(){var e={};r.columns.each(function(t){var r=t.get("axis")||"NONE";e[r]||(e[r]=[]),r.collection=null,e[r].push(t)}),t.chart.unusedSeries.reset(e.NONE||[]),e.X&&e.X.length?t.chart.xAxis.useColumn(e.X[0]):t.chart.xAxis.set(t.chart.xAxis.defaults),t.chart.yAxis.columns.reset(e.Y||[]),t.chart.zAxis.columns.reset(e.Z||[])}),t.chart.yAxis.columns.on("change:isOther",function(e){console.log("IS OTHERS",this.findWhere({isOther:!0}))}),t.chart.xAxis.on("change:datatype change:dateFormat",function(n){var i=n.get("property"),a=n.get("datatype"),o=r.get("data"),s=n.get("dateFormat"),c=e(o,i);Datatypes.isNumeric(a)?transform.series(c,i,transform.number()):Datatypes.isTime(a)&&s&&transform.series(c,i,transform.time(s)),t.chart.dataset.set("rows",c)}),r.columns.each(c),ViewInlineHelp.init(),document.body.appendChild(fontFix()),"#test"===document.location.hash){var l=require("fs"),u=l.readFileSync(__dirname+"/sampledata/BigChinaSlowdown.txt","utf8");r.set({dataAsString:u,type:"text/plain"},{validate:!0})}}function nightingale(){var e=new Authentication(init);return e.renderButton(),{oChartsVersion:require("o-charts").version}}var Backbone=require("./core/backbone"),Graphic=require("./models/Graphic.js"),ViewGraphicControls=require("./views/GraphicControls.js"),ViewGraphicTypes=require("./views/GraphicTypes.js"),GraphicType=require("./models/GraphicType.js"),DataImport=require("./models/import.js"),ViewImportData=require("./views/ImportData.js"),ViewInlineHelp=require("./views/InlineHelp.js"),ViewSelectedVariation=require("./views/SelectedVariation.js"),Variations=require("./charting/Variations.js"),LineControls=require("./models/LineControls.js"),ColumnControls=require("./models/ColumnControls.js"),transform=require("./transform/index.js"),Datatypes=require("./charting/Datatypes.js"),fontFix=require("./export/svgDataURI.js").fontFix,Authentication=require("./utils/authentication.js"),_=require("underscore"),$=require("jquery");module.exports=window.nightingale=nightingale;