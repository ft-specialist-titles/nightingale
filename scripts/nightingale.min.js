function init(){function e(e,t){var r=n.get("originalData");return e.map(function(e,n){return e[t]=r[n][t],e})}var t=new Graphic,n=new DataImport,r=new ViewGraphicControls({model:t,dataImport:n});document.getElementById("controls").appendChild(r.render().el);var i=new Backbone.Collection([new GraphicType({typeName:"Line"},{graphic:t,controls:new LineControls,variations:Variations}),new GraphicType({typeName:"Column"},{graphic:t,controls:new ColumnControls,variations:Variations})]);i.comparator="suitabilityRanking";var a=new ViewGraphicTypes({collection:i}),o=document.getElementById("charts");o.classList.add("full"),o.appendChild(a.render().el);var s;Backbone.on("selectVariation",function(e){if(s){if(s.model===e)return;s.remove()}e&&e.get("svg")&&(s=new ViewSelectedVariation({model:e}),s.render(),document.getElementById("selection").appendChild(s.el))}),n.on("change:pipelineOptions",function(e,n){if(!n)return void t.set(t.defaults);var r=_.pick(n,"title","subtitle","source","footnote");t.set(r)}),n.on("change:recommendedChartStyle",function(e,t){var n=e.get("recommendedChartStyle");i.forEach(function(e){e.get("typeName")===n?(e.set("suitabilityRanking",-100,{silent:!0}),e.set("recommended",!0)):(e.set("suitabilityRanking",100,{silent:!0}),e.set("recommended",!1))}),i.sort()}),n.on("change:data",function(e,n){t.chart.dataset.set("rows",n)});var c=new ViewImportData({model:n});document.getElementById("controls").appendChild(c.render().el);var l=function(e,n){e.collection=null;var r,i=e.get("axis");"undefined"!=typeof e._previousAttributes.axis&&(r=e._previousAttributes.axis,r&&i!==r&&("Y"===r?t.chart.yAxis.columns.remove(e):"Z"===r&&t.chart.zAxis.columns.remove(e))),i&&("Y"===i?t.chart.yAxis.columns.add(e):"Z"===i&&t.chart.zAxis.columns.add(e))};if(n.columns.on("change:axis",l),n.columns.on("reset",function(){var e={};n.columns.each(function(t){var n=t.get("axis")||"NONE";e[n]||(e[n]=[]),n.collection=null,e[n].push(t)}),t.chart.unusedSeries.reset(e.NONE||[]),e.X&&e.X.length?t.chart.xAxis.useColumn(e.X[0]):t.chart.xAxis.set(t.chart.xAxis.defaults),t.chart.yAxis.columns.reset(e.Y||[]),t.chart.zAxis.columns.reset(e.Z||[])}),t.chart.yAxis.columns.on("change:isOther",function(e){console.log("IS OTHERS",this.findWhere({isOther:!0}))}),t.chart.xAxis.on("change:dataType change:dateFormat",function(r){var i=r.get("property"),a=r.get("dataType"),o=n.get("data"),s=r.get("dateFormat"),c=e(o,i);Datatypes.isNumeric(a)?transform.series(c,i,transform.number()):Datatypes.isTime(a)&&s&&transform.series(c,i,transform.time(s)),t.chart.dataset.set("rows",c)}),n.columns.each(l),ViewInlineHelp.init(),document.body.appendChild(fontFix()),"#test"===document.location.hash){var u=require("fs"),d=u.readFileSync(__dirname+"/sampledata/BigChinaSlowdown.txt","utf8");n.set({dataAsString:d,type:"text/plain"},{validate:!0})}}function nightingale(){var e=new Authentication(init);return e.renderButton(),{oChartsVersion:require("o-charts").version}}var Backbone=require("./core/backbone"),Graphic=require("./models/Graphic.js"),ViewGraphicControls=require("./views/GraphicControls.js"),ViewGraphicTypes=require("./views/GraphicTypes.js"),GraphicType=require("./models/GraphicType.js"),DataImport=require("./models/import.js"),ViewImportData=require("./views/ImportData.js"),ViewInlineHelp=require("./views/InlineHelp.js"),ViewSelectedVariation=require("./views/SelectedVariation.js"),Variations=require("./charting/Variations.js"),LineControls=require("./models/LineControls.js"),ColumnControls=require("./models/ColumnControls.js"),transform=require("./transform/index.js"),Datatypes=require("./charting/Datatypes.js"),fontFix=require("./export/svgDataURI.js").fontFix,Authentication=require("./utils/authentication.js"),_=require("underscore"),$=require("jquery");module.exports=window.nightingale=nightingale;