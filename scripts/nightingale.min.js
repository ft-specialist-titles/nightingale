function init(){function e(e){var t=e.get("recommendedChartStyle");a.forEach(function(e){e.get("typeName")===t?(e.set("suitabilityRanking",-100,{silent:!0}),e.set("recommended",!0)):(e.set("suitabilityRanking",100,{silent:!0}),e.set("recommended",!1))}),a.sort()}function t(e,t){var r=n.get("originalData");return e.map(function(e,n){return e[t]=r[n][t],e})}var r=new Graphic,n=new DataImport,i=new ViewGraphicControls({model:r,dataImport:n});document.getElementById("controls").appendChild(i.render().el);var a=new Backbone.Collection([new GraphicType({typeName:"Line"},{graphic:r,controls:new LineControls,variations:Variations}),new GraphicType({typeName:"Column"},{graphic:r,controls:new ColumnControls,variations:Variations}),new GraphicType({typeName:"Bar"},{graphic:r,controls:new BarControls,variations:Variations})]);a.comparator="suitabilityRanking";var o=new ViewGraphicTypes({collection:a}),s=document.getElementById("charts");s.classList.add("full"),s.appendChild(o.render().el);var c;Backbone.on("selectVariation",function(e){if(c){if(c.model===e)return;c.remove()}e&&e.get("svg")&&(c=new ViewSelectedVariation({model:e}),c.render(),document.getElementById("selection").appendChild(c.el))}),n.on("change:pipelineOptions",function(e,t){if(!t)return void r.set(r.defaults);var n=_.pick(t,"title","subtitle","source","footnote");r.set(n)}),n.on("change:recommendedChartStyle",function(t,r){e(t)}),n.on("change:data",function(t,n){e(t),r.chart.dataset.set("rows",n)});var l=new ViewImportData({model:n});document.getElementById("controls").appendChild(l.render().el);var u=function(e,t){e.collection=null;var n,i=e.get("axis");"undefined"!=typeof e._previousAttributes.axis&&(n=e._previousAttributes.axis,n&&i!==n&&("Y"===n?r.chart.yAxis.columns.remove(e):"Z"===n&&r.chart.zAxis.columns.remove(e))),i&&("Y"===i?r.chart.yAxis.columns.add(e):"Z"===i&&r.chart.zAxis.columns.add(e))};if(n.columns.on("change:axis",u),n.columns.on("reset",function(){var e={};n.columns.each(function(t){var r=t.get("axis")||"NONE";e[r]||(e[r]=[]),r.collection=null,e[r].push(t)}),r.chart.unusedSeries.reset(e.NONE||[]),e.X&&e.X.length?r.chart.xAxis.useColumn(e.X[0]):r.chart.xAxis.set(r.chart.xAxis.defaults),r.chart.yAxis.columns.reset(e.Y||[]),r.chart.zAxis.columns.reset(e.Z||[])}),r.chart.yAxis.columns.on("change:isOther",function(e){console.log("IS OTHERS",this.findWhere({isOther:!0}))}),r.chart.xAxis.on("change:dataType change:dateFormat",function(e){var i=e.get("property"),a=e.get("dataType"),o=n.get("data"),s=e.get("dateFormat"),c=t(o,i);r.chart.xAxis.attributes.units=n.groupDates(s),DataTypes.isNumeric(a)?transform.series(c,i,transform.number()):DataTypes.isTime(a)&&s&&transform.series(c,i,transform.time(s)),r.chart.dataset.set("rows",c)}),n.columns.each(u),ViewInlineHelp.init(),document.body.appendChild(fontFix()),"#test"===document.location.hash){var d=require("fs"),m=d.readFileSync(__dirname+"/sampledata/BigChinaSlowdown.txt","utf8");n.set({dataAsString:m,type:"text/plain"},{validate:!0})}}function nightingale(){var e=new Authentication(init);return e.renderButton(),{oChartsVersion:require("o-charts").version}}var Backbone=require("./core/backbone"),Graphic=require("./models/Graphic.js"),ViewGraphicControls=require("./views/GraphicControls.js"),ViewGraphicTypes=require("./views/GraphicTypes.js"),GraphicType=require("./models/GraphicType.js"),DataImport=require("./models/import.js"),ViewImportData=require("./views/ImportData.js"),ViewInlineHelp=require("./views/InlineHelp.js"),ViewSelectedVariation=require("./views/SelectedVariation.js"),Variations=require("./charting/Variations.js"),LineControls=require("./models/LineControls.js"),ColumnControls=require("./models/ColumnControls.js"),BarControls=require("./models/BarControls.js"),transform=require("./transform/index.js"),DataTypes=require("./charting/Datatypes.js"),fontFix=require("./export/svgDataURI.js").fontFix,Authentication=require("./utils/authentication.js"),_=require("underscore"),$=require("jquery");module.exports=window.nightingale=nightingale;