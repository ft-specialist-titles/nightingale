function init(){function e(e,t){var r=i.get("originalData");return e.map(function(e,i){return e[t]=r[i][t],e})}var t=new Graphic,i=new DataImport,r=new ViewGraphicControls({model:t,dataImport:i});document.getElementById("controls").appendChild(r.render().el);var n=new Backbone.Collection([new GraphicType({typeName:"Line"},{graphic:t,controls:new LineControls,variations:Variations}),new GraphicType({typeName:"Column"},{graphic:t,controls:new ColumnControls,variations:Variations})]);n.comparator="suitabilityRanking";var a=new ViewGraphicTypes({collection:n}),o=document.getElementById("charts");o.classList.add("full"),o.appendChild(a.render().el);var s;Backbone.on("selectVariation",function(e){if(s){if(s.model===e)return;s.remove()}e&&e.get("svg")&&(s=new ViewSelectedVariation({model:e}),s.render(),document.getElementById("selection").appendChild(s.el))}),i.on("change:pipelineOptions",function(e,i){if(!i)return void t.set(t.defaults);var r=_.pick(i,"title","subtitle","source","footnote");t.set(r)}),i.on("change:data",function(e,i){var r=e.get("recommendedChartStyle");n.forEach(function(e){e.get("typeName")==r?(e.set("suitabilityRanking",-100,{silent:!0}),e.set("recommended",!0)):(e.set("suitabilityRanking",100,{silent:!0}),e.set("recommended",!1))}),n.sort(),t.chart.dataset.set("rows",i)});var c=new ViewImportData({model:i});document.getElementById("controls").appendChild(c.render().el);var l=function(e,i){e.collection=null;var r,n=e.get("axis");"undefined"!=typeof e._previousAttributes.axis&&(r=e._previousAttributes.axis,r&&n!==r&&("Y"===r?t.chart.yAxis.columns.remove(e):"Z"===r&&t.chart.zAxis.columns.remove(e))),n&&("Y"===n?t.chart.yAxis.columns.add(e):"Z"===n&&t.chart.zAxis.columns.add(e))};if(i.columns.on("change:axis",l),i.columns.on("reset",function(){var e={};i.columns.each(function(t){var i=t.get("axis")||"NONE";e[i]||(e[i]=[]),i.collection=null,e[i].push(t)}),t.chart.unusedSeries.reset(e.NONE||[]),e.X&&e.X.length?t.chart.xAxis.useColumn(e.X[0]):t.chart.xAxis.set(t.chart.xAxis.defaults),t.chart.yAxis.columns.reset(e.Y||[]),t.chart.zAxis.columns.reset(e.Z||[])}),t.chart.yAxis.columns.on("change:isOther",function(e){console.log("IS OTHERS",this.findWhere({isOther:!0}))}),t.chart.xAxis.on("change:datatype change:dateFormat",function(r){var n=r.get("property"),a=r.get("datatype"),o=i.get("data"),s=r.get("dateFormat"),c=e(o,n);Datatypes.isNumeric(a)?transform.series(c,n,transform.number()):Datatypes.isTime(a)&&s&&transform.series(c,n,transform.time(s)),t.chart.dataset.set("rows",c)}),i.columns.each(l),ViewInlineHelp.init(),document.body.appendChild(fontFix()),"#test"===document.location.hash){var u=require("fs"),d=u.readFileSync(__dirname+"/sampledata/BigChinaSlowdown.txt","utf8");i.set({dataAsString:d,type:"text/plain"},{validate:!0})}}function nightingale(){var e=new Authentication(init);return e.renderButton(),{oChartsVersion:require("o-charts").version}}var Backbone=require("./core/backbone"),Graphic=require("./models/Graphic.js"),ViewGraphicControls=require("./views/GraphicControls.js"),ViewGraphicTypes=require("./views/GraphicTypes.js"),GraphicType=require("./models/GraphicType.js"),DataImport=require("./models/import.js"),ViewImportData=require("./views/ImportData.js"),ViewInlineHelp=require("./views/InlineHelp.js"),ViewSelectedVariation=require("./views/SelectedVariation.js"),Variations=require("./charting/Variations.js"),LineControls=require("./models/LineControls.js"),ColumnControls=require("./models/ColumnControls.js"),transform=require("./transform/index.js"),Datatypes=require("./charting/Datatypes.js"),fontFix=require("./export/svgDataURI.js").fontFix,Authentication=require("./utils/authentication.js"),_=require("underscore"),$=require("jquery");module.exports=window.nightingale=nightingale;